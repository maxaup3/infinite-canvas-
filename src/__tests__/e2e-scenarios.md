# E2E 测试场景

这个文件定义了 Infinite Canvas 项目的端到端测试场景。

## 场景 1: 图像生成完整流程

### 步骤
1. 打开应用
2. 确认对话框已展开
3. 选择"图像生成"模式
4. 输入提示词："a beautiful sunset"
5. 点击生成按钮
6. 等待生成完成（进度条 100%）
7. 验证画布上出现新图片
8. 验证图片位置在画布中心

### 预期结果
- 生成任务创建成功
- 进度条正常更新
- 生成完成后图片显示在画布上
- 图片可以选中
- 图片显示在正确位置

---

## 场景 2: 填入对话 - 图像模式

### 步骤
1. 打开应用
2. 生成一张图片（参考场景1）
3. 选中生成的图片
4. 点击图片上方快捷操作栏的"填入对话"按钮
5. 验证图片缩略图出现在对话框中
6. 再次点击"填入对话"添加第二张
7. 继续添加直到10张
8. 尝试添加第11张

### 预期结果
- 前10张图片成功添加到 referenceImages
- 每张图片都显示缩略图
- 缩略图有删除按钮
- 第11张图片添加时显示错误："最多只能添加10张参考图片"
- 错误提示3秒后自动消失

---

## 场景 3: 填入对话 - 视频模式（图生视频）

### 步骤
1. 打开应用
2. 生成一张图片
3. 切换到"视频生成"模式
4. 选择"图生视频"能力
5. 选中图片并点击"填入对话"
6. 验证图片填入首帧位置
7. 尝试再次填入图片

### 预期结果
- 第一张图片成功填入 videoStartFrame
- 显示首帧缩略图
- 第二张图片填入时显示错误："图生视频只需要一张参考图片"
- 错误提示3秒后自动消失

---

## 场景 4: 填入对话 - 视频模式（首尾帧）

### 步骤
1. 打开应用
2. 生成两张图片
3. 切换到"视频生成"模式
4. 选择"首尾帧"能力
5. 选中第一张图片并点击"填入对话"
6. 验证图片填入首帧位置
7. 选中第二张图片并点击"填入对话"
8. 验证图片填入尾帧位置
9. 尝试再次填入图片

### 预期结果
- 第一张图片成功填入 videoStartFrame
- 第二张图片成功填入 videoEndFrame
- 显示首帧和尾帧缩略图
- 第三张图片填入时显示错误："首尾帧已填满，无法继续添加"
- 错误提示3秒后自动消失

---

## 场景 5: 选中图层后生成（位置验证）

### 步骤
1. 打开应用
2. 生成一张图片
3. 记录图片的位置和宽度（x, width）
4. 选中这张图片
5. 输入提示词并点击生成
6. 观察"生成中"遮罩的位置
7. 等待生成完成
8. 验证新图片的位置

### 预期结果
- "生成中"遮罩显示在：x = selectedLayer.x + selectedLayer.width + 20, y = selectedLayer.y
- 最终图片显示在相同位置
- 图片顶部对齐（y 坐标相同）
- 图片之间间距 20px

---

## 场景 6: 画布交互 - 双指平移

### 步骤
1. 打开应用
2. 生成一张图片
3. 选中这张图片
4. 使用双指在触控板上平移
5. 验证画布移动，图片相对位置不变

### 预期结果
- 选中的图片不可拖拽（draggable = false）
- 双指平移移动整个画布
- 图片相对于画布的位置保持不变
- 不会触发图片的缩放功能

---

## 场景 7: Cmd+点击快速填入

### 步骤
1. 打开应用
2. 生成一张图片
3. 按住 Cmd 键（Mac）或 Ctrl 键（Windows）
4. 点击图片
5. 释放 Cmd/Ctrl 键

### 预期结果
- 图片立即添加到对话框
- 根据当前模式填入相应位置：
  - 图像模式：添加到 referenceImages
  - 视频（图生视频）：设置为 videoStartFrame
  - 视频（首尾帧）：按顺序填入首帧或尾帧

---

## 场景 8: 下载菜单

### 步骤
1. 打开应用
2. 生成多张图片
3. 选中多张图片（Ctrl/Cmd + 点击）
4. 将鼠标悬停在快捷操作栏的下载图标上
5. 验证下拉菜单出现
6. 验证菜单包含"批量下载"和"合并下载"选项
7. 移开鼠标
8. 验证菜单消失

### 预期结果
- Hover 下载图标时显示下拉菜单
- 菜单显示两个选项
- 鼠标移开时菜单消失
- 点击选项执行相应功能

---

## 场景 9: 通知隐藏

### 步骤
1. 打开应用
2. 生成一张图片
3. 等待生成完成
4. 验证没有成功通知弹出
5. 删除图片
6. 验证没有删除通知弹出
7. 生成一张图片并选中
8. 点击 Re-run
9. 验证没有开始生成通知弹出

### 预期结果
- 生成完成：没有"成功生成 X 张图片"通知
- 删除图片：没有"已删除 X 张图片"通知
- 重新生成：没有"开始重新生成..."通知

---

## 场景 10: Artifacts 隐藏

### 步骤
1. 打开应用
2. 检查右下角是否有 Artifacts 按钮
3. 检查是否有 Artifacts 面板

### 预期结果
- Artifacts 按钮不显示
- Artifacts 面板不显示
- 相关功能完全隐藏

---

## 场景 11: 错误提示自动消失

### 步骤
1. 打开应用（图像模式）
2. 使用"填入对话"添加10张图片
3. 尝试添加第11张
4. 观察错误提示
5. 开始计时
6. 等待3秒
7. 验证错误提示消失

### 预期结果
- 错误提示立即显示
- 错误提示包含正确的文字
- 错误提示样式：半透明背景，红色文字
- 正好3秒后错误提示自动消失

---

## 场景 12: 模式切换保留配置

### 步骤
1. 打开应用（图像模式）
2. 添加参考图片
3. 设置 Lora
4. 输入提示词
5. 切换到视频模式
6. 验证提示词和 Lora 保留
7. 切换回图像模式
8. 验证所有配置仍然保留

### 预期结果
- 模式切换时保留：prompt, lora, loraWeight
- 模式特有配置正确初始化：
  - 视频模式：videoCapability, videoDuration 等
  - 图像模式：referenceImages
- UI 正确反映当前配置

---

## 测试优先级

### P0（关键功能，必须通过）
- 场景 1: 图像生成完整流程
- 场景 2: 填入对话 - 图像模式
- 场景 5: 选中图层后生成（位置验证）

### P1（重要功能）
- 场景 3: 填入对话 - 视频模式（图生视频）
- 场景 4: 填入对话 - 视频模式（首尾帧）
- 场景 6: 画布交互 - 双指平移
- 场景 11: 错误提示自动消失

### P2（辅助功能）
- 场景 7: Cmd+点击快速填入
- 场景 8: 下载菜单
- 场景 9: 通知隐藏
- 场景 10: Artifacts 隐藏
- 场景 12: 模式切换保留配置
